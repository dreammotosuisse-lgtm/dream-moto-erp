<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <data>
        <record id="vehicle_booking_form_view" model="ir.ui.view">
            <field name="name">vehicle.booking.form.view</field>
            <field name="model">vehicle.booking</field>
            <field name="arch" type="xml">
                <form duplicate="false">
                    <header>
                        <field name="is_registered_vehicle" invisible="1"/>
                        <field name="booking_stages" widget="statusbar" statusbar_visible="draft"/>
                        <button string="Link Vehicle to Customer" name="action_create_vehicle_registration"
                                class="btn btn-info" type="object"
                                invisible="vehicle_from != 'new' or is_registered_vehicle != False or booking_stages != 'draft'"/>

                        <button string="Vehicle Inspection" name="draft_to_vehicle_inspection" type="object"
                                class="oe_highlight"
                                invisible="booking_type != 'only_inspection' or inspection_job_card_id != False or booking_stages == 'cancel'"/>

                        <button string="Vehicle Repair" name="vehicle_inspection_to_vehicle_repair" type="object"
                                class="oe_highlight"
                                invisible="booking_type != 'only_repair' or repair_job_card_id != False or booking_stages == 'cancel'"/>

                        <button string="Vehicle Inspection + Repair" name="vehicle_repair_to_vehicle_inspection_repair"
                                type="object" class="oe_highlight"
                                invisible="booking_type != 'inspection_and_repair' or inspection_job_card_id != False or booking_stages == 'cancel'"/>

                        <button string="Cancel" name="vehicle_inspection_repair_to_cancel" type="object" icon="fa-close"
                                class="btn btn-danger" groups="tk_advance_vehicle_repair.vehicle_repair_manager"
                                confirm="Are you sure you want to cancel the booking?"
                                invisible="booking_stages == 'cancel' or inspection_job_card_id != False or repair_job_card_id != False"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="booking_number"/>
                                <br/>
                                <h3>
                                    <field name="vehicle_from" widget="radio" options="{'horizontal': true}"
                                           force_save="1"
                                           readonly="booking_stages != 'draft' or booking_source == 'website' or register_vehicle_id != False"/>
                                </h3>
                            </h1>
                        </div>
                        <separator string="Vehicle Details" name="booking_vehicle_details"/>
                        <group>
                            <group>
                                <field name="customer_id" required="1" readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="fleet_vehicle_id" invisible="vehicle_from != 'fleet_vehicle'"
                                       readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="register_vehicle_id" invisible="vehicle_from != 'customer_vehicle'"
                                       readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="vehicle_brand_id" required="1" readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="registration_no" required="1" readonly="booking_stages != 'draft'"/>
                            </group>
                            <group>
                                <field name="vehicle_model_id" required="1" readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="vehicle_fuel_type_id" required="1" readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="vin_no" readonly="booking_stages != 'draft'"/>
                                <field name="transmission_type" widget="radio" options="{'horizontal': true}"
                                       readonly="booking_stages != 'draft'"/>
                            </group>
                        </group>
                        <separator string="Customer Address Details" name="booking_customer_address_details"/>
                        <group>
                            <group>
                                <span class="o_form_label o_td_label" name="address_name">Address
                                </span>
                                <div class="o_address_format">
                                    <field name="street" placeholder="Street..." class="o_address_street"
                                           readonly="booking_stages != 'draft'"/>
                                    <field name="street2" placeholder="Street 2..." class="o_address_street"
                                           readonly="booking_stages != 'draft'"/>
                                    <field name="city" placeholder="City" class="o_address_city" required="1"
                                           readonly="booking_stages != 'draft'"/>
                                    <field name="state_id" class="o_address_state" placeholder="State"
                                           options="{'no_create':True,'no_create_edit':True,'no_open':True}"
                                           readonly="booking_stages != 'draft'"/>
                                    <field name="zip" placeholder="ZIP" class="o_address_zip"
                                           readonly="booking_stages != 'draft'"/>
                                    <field name="country_id" placeholder="Country" class="o_address_country"
                                           options="{'no_create':True,'no_create_edit':True,'no_open':True}"
                                           readonly="booking_stages != 'draft'"/>
                                </div>
                            </group>
                            <group>
                                <field name="phone" readonly="booking_stages != 'draft'"/>
                                <field name="email" readonly="booking_stages != 'draft'"/>
                            </group>
                        </group>
                        <separator string="Booking Details" name="vehicle_booking_details"/>
                        <group>
                            <group>
                                <field name="booking_source" widget="radio" options="{'horizontal': true}"
                                       readonly="1"/>
                                <field name="booking_type" widget="radio"
                                       readonly="booking_stages != 'draft'"/>
                            </group>
                            <group>
                                <field name="booking_date" required="1" readonly="booking_stages != 'draft'"/>
                                <field name="booking_appointment_id" readonly="1" force_save="1"
                                       invisible="booking_source != 'direct'"/>
                                <field name="booking_appointment_slot_ids" invisible="1"/>
                                <field name="booking_appointment_slot_id" readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="inspection_job_card_id" invisible="inspection_job_card_id == False"
                                       readonly="1"/>
                                <field name="repair_job_card_id" invisible="repair_job_card_id == False" readonly="1"/>
                            </group>
                        </group>
                        <separator string="Vehicle Services &amp; Spare Parts"
                                   name="vehicle_booking_service_spare_part_details"
                                   invisible="booking_type == 'only_inspection'"/>
                        <group invisible="booking_type == 'only_inspection'">
                            <group>
                                <field name="vehicle_service_ids" widget="many2many_tags"
                                       options="{'color_field': 'color', 'no_create': True, 'no_create_edit': True}"
                                       readonly="booking_stages != 'draft'"/>
                            </group>
                            <group>
                                <field name="vehicle_spare_part_ids" widget="many2many_tags"
                                       options="{'color_field': 'color', 'no_create': True, 'no_create_edit': True}"
                                       readonly="booking_stages != 'draft'"/>
                            </group>
                        </group>
                        <group>
                            <group string="Additional Information" name="booking_additional_information">
                                <field name="access_token" invisible="1"/>
                                <field name="company_id" required="1" readonly="booking_stages != 'draft'"
                                       options="{'no_create': True, 'no_create_edit': True}"/>
                                <field name="responsible_id" widget="many2one_avatar_user" required="1"
                                       options="{'no_create': True, 'no_create_edit': True}"
                                       readonly="booking_stages != 'draft'"/>
                            </group>
                            <group string="Quick Estimation Cost" invisible="booking_type == 'only_inspection'"
                                   name="booking_quick_estimation_cost">
                                <field name="estimate_cost" readonly="booking_stages != 'draft'"/>
                                <field name="company_id" invisible="1"/>
                                <field name="currency_id" invisible="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="customer_observation" string="Customer Observations">
                                <field name="customer_observation" nolabel="1" readonly="booking_stages != 'draft'"/>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>
        <record id="vehicle_booking_list_view" model="ir.ui.view">
            <field name="name">vehicle.booking.list.view</field>
            <field name="model">vehicle.booking</field>
            <field name="arch" type="xml">
                <list duplicate="false">
                    <field name="booking_number"/>
                    <field name="booking_date"/>
                    <field name="customer_id"/>
                    <field name="vehicle_brand_id"/>
                    <field name="registration_no"/>
                    <field name="booking_source"/>
                    <field name="booking_type"/>
                    <field name="booking_appointment_slot_id"/>
                    <field name="booking_stages" widget="badge" optional="show"
                           decoration-info="booking_stages == 'draft'"
                           decoration-warning="booking_stages == 'vehicle_inspection'"
                           decoration-primary="booking_stages == 'vehicle_repair'"
                           decoration-success="booking_stages == 'vehicle_inspection_repair'"
                           decoration-danger="booking_stages == 'cancel'"/>
                </list>
            </field>
        </record>
        <record id="vehicle_booking_kanban_view" model="ir.ui.view">
            <field name="name">vehicle.booking.kanban.view</field>
            <field name="model">vehicle.booking</field>
            <field name="arch" type="xml">
                <kanban edit="false" group_create="0" records_draggable="0" class="o_slide_kanban" sample="1"
                        quick_create="false">
                    <field name="id"/>
                    <field name="booking_number"/>
                    <field name="booking_date"/>
                    <field name="vehicle_brand_id"/>
                    <field name="vehicle_model_id"/>
                    <field name="registration_no"/>
                    <field name="booking_stages"/>
                    <field name="customer_id"/>
                    <field name="activity_ids"/>
                    <templates>
                        <t t-name="card">
                            <main>
                                <!-- Header -->
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <field name="booking_number" class="fw-bold fs-5"/>
                                    <field name="responsible_id" widget="many2one_avatar_user"
                                           class="fw-bolder ms-auto"/>
                                </div>
                                <!--Center-->
                                <div class="mb-2">
                                    <div class="text-muted small mb-1">
                                        <i class="fa fa-car me-1" title="Vehicle"/>
                                        <field name="vehicle_brand_id" class="me-1"/>/
                                        <field name="vehicle_model_id" class="me-1"/>/
                                        <field name="registration_no"/>
                                    </div>
                                    <div class="text-muted small">
                                        <i class="fa fa-user me-1" title="Customer"/>
                                        <field name="customer_id"/>
                                    </div>
                                </div>
                                <!-- Footer -->
                                <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                                    <div class="text-muted small d-flex align-items-center flex-wrap">
                                        <i class="fa fa-calendar me-1" title="Booking Date"/>
                                        <field name="booking_date" class="me-1"/>
                                        <field name="activity_ids" widget="kanban_activity" class="ms-2"/>
                                    </div>
                                    <div class="fw-bold text-end">
                                        <field name="booking_stages" widget="label_selection"
                                               options="{'classes': {
                                                                    'draft': 'info',
                                                                     'vehicle_inspection': 'warning',
                                                                     'vehicle_repair': 'success',
                                                                      'vehicle_inspection_repair': 'info',
                                                                      'cancel': 'danger'}}"/>
                                    </div>
                                </div>
                            </main>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record id="vehicle_booking_pivot_view" model="ir.ui.view">
            <field name="name">vehicle.booking.pivot.view</field>
            <field name="model">vehicle.booking</field>
            <field name="priority">60</field>
            <field name="arch" type="xml">
                <pivot string="Vehicle Booking Details" sample="1">
                    <field name="booking_stages" type="col"/>
                    <field name="booking_date" interval="month" type="row"/>
                    <field name="booking_number" type="row"/>
                </pivot>
            </field>
        </record>
        <record id="vehicle_booking_calendar_view" model="ir.ui.view">
            <field name="name">vehicle.booking.calendar.view</field>
            <field name="model">vehicle.booking</field>
            <field name="arch" type="xml">
                <calendar string="Vehicle Booking Calendar"
                          date_start="booking_date"
                          event_open_popup="true"
                          mode="month"
                          color="booking_type"
                          scales="day,month,year"
                          quick_create="False">
                    <field name="booking_type" filters="1" options="{'icon': 'fa fa-bars'}"/>
                    <field name="customer_id" widget="many2one_avatar" options="{'icon': 'fa fa-user'}"/>
                    <field name="phone" options="{'icon': 'fa fa-phone'}"/>
                    <field name="email" options="{'icon': 'fa fa-envelope'}"/>
                    <field name="vehicle_from" invisible="1"/>
                    <field name="fleet_vehicle_id" invisible="not fleet_vehicle_id" options="{'icon': 'fa fa-car'}"/>
                    <field name="register_vehicle_id" invisible="not register_vehicle_id"
                           options="{'icon': 'fa fa-car'}"/>
                    <field name="vehicle_brand_id" invisible="vehicle_from != 'new'" options="{'icon': 'fa fa-car'}"/>
                    <field name="responsible_id" widget="many2one_avatar" options="{'icon': 'fa fa-user'}"/>
                </calendar>
            </field>
        </record>
        <record id="vehicle_booking_search_view" model="ir.ui.view">
            <field name="name">vehicle.booking.search.view</field>
            <field name="model">vehicle.booking</field>
            <field name="arch" type="xml">
                <search>
                    <field name="booking_number"/>
                    <field name="vehicle_brand_id"/>
                    <field name="vehicle_model_id"/>
                    <field name="customer_id"/>
                    <field name="registration_no"/>
                    <field name="vehicle_fuel_type_id"/>
                    <group>
                        <filter name="customer_id" string="Customer"
                                context="{'group_by': 'customer_id'}"/>
                        <filter name="booking_source" string="Booking Source"
                                context="{'group_by': 'booking_source'}"/>
                        <filter name="vehicle_brand_id" string="Brand"
                                context="{'group_by': 'vehicle_brand_id'}"/>
                        <filter name="vehicle_model_id" string="Model"
                                context="{'group_by': 'vehicle_model_id'}"/>
                        <filter name="vehicle_fuel_type_id" string="Fuel Type"
                                context="{'group_by': 'vehicle_fuel_type_id'}"/>
                        <filter name="transmission_type" string="Transmission Type"
                                context="{'group_by': 'transmission_type'}"/>
                        <filter name="booking_type" string="Booking Type"
                                context="{'group_by': 'booking_type'}"/>
                        <filter name="booking_stages" string="Status"
                                context="{'group_by': 'booking_stages'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="action_vehicle_booking" model="ir.actions.act_window">
            <field name="name">Bookings</field>
            <field name="res_model">vehicle.booking</field>
            <field name="view_mode">kanban,list,form,calendar,search,pivot,activity</field>
        </record>
    </data>
</odoo>
